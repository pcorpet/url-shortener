version: "2"
services:
  db:
    image: mongo
    expose:
      - 27017
  web:
    build:
      context: .
      dockerfile: Dockerfile.build
    environment:
      PORT: 8080
      MONGODB_URL: db/test
    command: [./url-shortener]
    volumes:
      - ./public:/go/src/app/public:ro
    ports:
      - '8080:8080'
    links:
      - db
  builder:
    build:
      context: .
      dockerfile: Dockerfile.build
    volumes:
      - .:/go/src/app/:ro
      - ./release:/go/src/app/release:rw
